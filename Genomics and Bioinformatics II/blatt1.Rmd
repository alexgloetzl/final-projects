---
title: Simulation exercise in<br />**Genomik und Bioinformatik**
output: html_document
---

```{r simulation_options, include=FALSE}
library(knitr)
opts_chunk$set(fig.width=5, fig.height=5, fig.path='RmdFigs/', dpi=72,
               warning=FALSE, message=FALSE, prompt=TRUE, cache=FALSE)
set.seed(53079239)
```

Screening Noise
===============

In any sample of a single specific tissue, at most half of the genes
are actually expressed. Hence, a microarray as discussed in Chapter 13
measures only noise in half of the genes. In this assignment, we
simulate the strongest expression levels caused by noise and
illustrate the corresponding distribution.

**Question (a):** Simulate a matrix of random expression values using
`R`'s random number generator to draw from a normal distribution with
a mean of 6 and a standard deviation of 1. The matrix is to contain
values for 500 samples and 10000 genes.

```{r Ca}
genes <- 10000 #rows
samples <- 500 #columns

myDistr <- rnorm(genes*samples, 6, 1)
dim(myDistr) <- c(genes, samples)
```

**Question (b):** For each sample in your matrix, find the maximum
simulated expression level and plot a histogram of these maxima. To
the histogram, add the mean value of your distribution using the
functions `abline` and `mtext`. Does the histogram resemble a normal
distribution? Explain.

```{r Cb}
myMax <- apply(myDistr, 2, max)
hist(myMax, main = "max expr per column", xlim = c(min(myDistr)-1, max(myDistr)+1))
myMean <- mean(myDistr)
abline(v = myMean, col = "red")
mtext("Mean", side = 3, col = "red", line = 0, outer=FALSE)
```

**Question (c):** Why is the histogram somewhat bumpy? Help to fix
this issue by plotting a smoothed density instead of the histogram by
using the function `density`.

```{r Cc}
dens <- density(myMax)
plot(dens)
```

**Question (d):** Use the function `qqnorm` to make a Q-Q plot of the
maxima against a normal distribution.  Describe the interpretation
of the form of a normal Q-Q plot in your own words.  As a help for
interpretation, add a line to the normal Q-Q-plot using the
`qqline` function. Describe how this line is generated and how it
helps to interpret a Q-Q-plot. Mimic the `qqnorm` function
only using the functions `plot` and `rnorm` in order to understand the
mechanism. Do the simulated maxima resemble a normal distribution
according to your own Q-Q-plot?

```{r Cd}
qqnorm(myMax)
qqline(myMax, col="steelblue", lw=2)
```

**Answer:** A `qqplot` is generated by comparing a normal distribution with another arbitrary distribution.
First both distributions are sorted and then plotted against each other,
i.e. the x-value of first quantile of distribution 1 against 
x-value of first quantile of distribution 2 and so on.
`qqline` plots a normal distribution against a normal distribution and is therefore always straight.
In our example the `qqplot` is not following the straight 
blue `qqline`, indicating that our random maxima values 
do not follow a normal distribution.

```{r Ce, out.width = "75%", fig.align = "center"}
std_comp <- sd(myMax)
mean_comp <- mean(myMax)

sorted_my_comp <- sort(myMax, decreasing=FALSE)
sorted_my_comp_std <- (sorted_my_comp-mean_comp)/std_comp 

my_std2 <- quantile(rnorm(10000), prob=seq(0,1,1/(length(myMax)))) 

par(mar=c(2, 4, 2, 2))
par(mfrow=c(2,1))
plot(x=my_std2[1:(length(my_std2))-1], y=sorted_my_comp_std, main="my attempt at qq plot", xlim=c(min(sorted_my_comp_std)-1, max(sorted_my_comp_std)), xlab="")

qqnorm(myMax, xlim=c(min(sorted_my_comp_std)-1, max(sorted_my_comp_std)))
```

**Answer:** The graphs do not exactly look the same because `qqnorm` apparently takes a smooth normal distribution $f(x)=\frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}\quad$.
But I took random discrete values created by `rnorm` and hoping that the first element of my distribution lines approximately up with the first quantile calculated by `quantile()`.

Ideally one would solve the antiderivative $F(x)$ for 100 quantiles. But solving $F(x)=1/100$ for $x$ with $F(x) = \frac{1}{\sigma\sqrt{2\pi}} \int_{-\infty}^x e^{-\frac{1}{2} \left(\frac{t-\mu}{\sigma}\right)^2} \mathrm dt$ seems complicated.



Information about the used R and package versions
-------------------------------------------------

The used versions of R and packages to generate the report above are
the following:

```{r sessionInfo}
sessionInfo()
```

